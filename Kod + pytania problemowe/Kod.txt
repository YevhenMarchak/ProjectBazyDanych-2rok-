--                   TABLE: suppliers

CREATE TABLE suppliers (
    supplier_id BIGSERIAL PRIMARY KEY,
    company_name TEXT NOT NULL,
    address TEXT,
    phone TEXT,
    email TEXT,
    tax_id TEXT
);

INSERT INTO suppliers (company_name, address, phone, email, tax_id) VALUES
('ABC Electronics', 'ul. Piękna 10, Warszawa', '123-456-789', 'kontakt@abcelectronics.pl', '1234567890'),
('Tech Solutions', 'ul. Kwiatowa 5, Kraków', '987-654-321', 'biuro@techsolutions.pl', '0987654321'),
('Gadget World', 'ul. Nowa 20, Poznań', '555-666-777', 'info@gadgetworld.pl', '1122334455');


--                   TABLE: categories

CREATE TABLE categories (
    category_id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    description TEXT
);

INSERT INTO categories (name, description) VALUES
('Laptopy', 'Komputery przenośne różnych producentów'),
('Smartfony', 'Telefony komórkowe i akcesoria'),
('Akcesoria', 'Dodatkowe akcesoria komputerowe i mobilne');


--                   TABLE: products

CREATE TABLE products (
    product_id BIGSERIAL PRIMARY KEY,
    sku TEXT NOT NULL UNIQUE,
    name TEXT NOT NULL,
    description TEXT,
    category_id BIGINT NOT NULL,
    supplier_id BIGINT,
    weight NUMERIC(10,3) CHECK (weight >= 0),
    dimensions TEXT,

    CONSTRAINT fk_products_category
        FOREIGN KEY (category_id)
        REFERENCES categories(category_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT fk_products_supplier
        FOREIGN KEY (supplier_id)
        REFERENCES suppliers(supplier_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

INSERT INTO products (sku, name, description, category_id, supplier_id, weight, dimensions) VALUES
('SKU001', 'Laptop XYZ', 'Laptop 15" i7, 16GB RAM', 1, 1, 2.5, '35x25x2 cm'),
('SKU002', 'Smartfon ABC', 'Smartfon 6.5" OLED', 2, 2, 0.180, '16x7x0.8 cm'),
('SKU003', 'Mysz Gamingowa', 'Mysz przewodowa RGB', 3, 3, 0.120, '12x6x4 cm');


--                   TABLE: locations

CREATE TABLE locations (
    location_id BIGSERIAL PRIMARY KEY,
    location_code TEXT NOT NULL UNIQUE,
    location_type VARCHAR(50) NOT NULL,
    max_capacity NUMERIC(12,3) CHECK (max_capacity >= 0)
);

INSERT INTO locations (location_code, location_type, max_capacity) VALUES
('LOC001', 'Magazyn Główny', 1000),
('LOC002', 'Magazyn Boczny', 500),
('LOC003', 'Magazyn Zapasowy', 300);

--                   TABLE: inventory

CREATE TABLE inventory (
    inventory_id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL,
    location_id BIGINT NOT NULL,
    quantity NUMERIC(14,3) NOT NULL CHECK (quantity >= 0),
    last_updated TIMESTAMPTZ DEFAULT NOW(),

    CONSTRAINT uq_inventory_product_location UNIQUE (product_id, location_id),

    CONSTRAINT fk_inventory_product
        FOREIGN KEY (product_id)
        REFERENCES products(product_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT fk_inventory_location
        FOREIGN KEY (location_id)
        REFERENCES locations(location_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

INSERT INTO inventory (product_id, location_id, quantity) VALUES
(1, 1, 50),
(2, 1, 100),
(3, 2, 200);

--                   TABLE: employees

CREATE TABLE employees (
    employee_id BIGSERIAL PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    position VARCHAR(100) NOT NULL,
    hire_date DATE,
    phone TEXT,
    email TEXT
);

INSERT INTO employees (first_name, last_name, position, hire_date, phone, email) VALUES
('Jan', 'Kowalski', 'Magazynier', '2022-01-15', '111-222-333', 'jan.kowalski@firma.pl'),
('Anna', 'Nowak', 'Kierownik', '2021-03-01', '444-555-666', 'anna.nowak@firma.pl'),
('Piotr', 'Wiśniewski', 'Specjalista ds. logistyki', '2023-06-10', '777-888-999', 'piotr.wisniewski@firma.pl');


--                   TABLE: clients

CREATE TABLE clients (
    client_id BIGSERIAL PRIMARY KEY,
    company_name TEXT NOT NULL,
    delivery_address TEXT,
    phone TEXT,
    email TEXT,
    tax_id TEXT
);

INSERT INTO clients (company_name, delivery_address, phone, email, tax_id) VALUES
('Firma Alfa', 'ul. Zielona 1, Warszawa', '222-333-444', 'kontakt@firmaalfa.pl', '1231231230'),
('Firma Beta', 'ul. Słoneczna 5, Kraków', '333-444-555', 'biuro@firmabeta.pl', '3213213210'),
('Firma Gamma', 'ul. Leśna 10, Poznań', '444-555-666', 'info@firmagamma.pl', '4564564560');


--                   TABLE: receipts

CREATE TABLE receipts (
    receipt_id BIGSERIAL PRIMARY KEY,
    supplier_id BIGINT NOT NULL,
    employee_id BIGINT,
    receipt_date DATE DEFAULT CURRENT_DATE,
    external_invoice_no TEXT,
    status VARCHAR(50) NOT NULL,

    CONSTRAINT fk_receipts_supplier
        FOREIGN KEY (supplier_id)
        REFERENCES suppliers(supplier_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT fk_receipts_employee
        FOREIGN KEY (employee_id)
        REFERENCES employees(employee_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

INSERT INTO receipts (supplier_id, employee_id, receipt_date, external_invoice_no, status) VALUES
(1, 1, '2025-11-01', 'FV001', 'Oczekuje'),
(2, 2, '2025-11-03', 'FV002', 'Zrealizowana'),
(3, 3, '2025-11-05', 'FV003', 'Oczekuje');

--                   TABLE: receipt_details

CREATE TABLE receipt_details (
    receipt_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    expected_quantity NUMERIC(14,3) NOT NULL CHECK (expected_quantity >= 0),
    received_quantity NUMERIC(14,3) NOT NULL CHECK (received_quantity >= 0),

    PRIMARY KEY (receipt_id, product_id),

    CONSTRAINT fk_receipt_details_receipt
        FOREIGN KEY (receipt_id)
        REFERENCES receipts(receipt_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    CONSTRAINT fk_receipt_details_product
        FOREIGN KEY (product_id)
        REFERENCES products(product_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

INSERT INTO receipt_details (receipt_id, product_id, expected_quantity, received_quantity) VALUES
(1, 1, 50, 50),
(2, 2, 100, 90),
(3, 3, 200, 200);

--                   TABLE: shipments

CREATE TABLE shipments (
    shipment_id BIGSERIAL PRIMARY KEY,
    client_id BIGINT NOT NULL,
    employee_id BIGINT,
    shipment_date DATE DEFAULT CURRENT_DATE,
    client_order_no TEXT,
    status VARCHAR(50) NOT NULL,

    CONSTRAINT fk_shipments_client
        FOREIGN KEY (client_id)
        REFERENCES clients(client_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT fk_shipments_employee
        FOREIGN KEY (employee_id)
        REFERENCES employees(employee_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

INSERT INTO shipments (client_id, employee_id, shipment_date, client_order_no, status) VALUES
(1, 1, '2025-11-10', 'ZAM001', 'W trakcie'),
(2, 2, '2025-11-11', 'ZAM002', 'Zrealizowana'),
(3, 3, '2025-11-12', 'ZAM003', 'W trakcie');

--                   TABLE: shipment_details

CREATE TABLE shipment_details (
    shipment_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    quantity_to_ship NUMERIC(14,3) NOT NULL CHECK (quantity_to_ship >= 0),

    PRIMARY KEY (shipment_id, product_id),

    CONSTRAINT fk_shipment_details_shipment
        FOREIGN KEY (shipment_id)
        REFERENCES shipments(shipment_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    CONSTRAINT fk_shipment_details_product
        FOREIGN KEY (product_id)
        REFERENCES products(product_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
);

INSERT INTO shipment_details (shipment_id, product_id, quantity_to_ship) VALUES
(1, 1, 10),
(2, 2, 20),
(3, 3, 30);

--                INDeksy DODATKOWE

-- PRODUCTS
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_products_supplier ON products(supplier_id);

-- INVENTORY
CREATE INDEX idx_inventory_product ON inventory(product_id);
CREATE INDEX idx_inventory_location ON inventory(location_id);

-- RECEIPTS
CREATE INDEX idx_receipts_supplier ON receipts(supplier_id);
CREATE INDEX idx_receipts_employee ON receipts(employee_id);

-- SHIPMENTS
CREATE INDEX idx_shipments_client ON shipments(client_id);
CREATE INDEX idx_shipments_employee ON shipments(employee_id);
